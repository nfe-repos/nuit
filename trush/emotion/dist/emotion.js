define("#emotion/0.1.0/emotion",["#jquery/0.1.0/jquery","#mfz/0.1.0/mfz"],function(e,t,n){var r=e("#jquery/0.1.0/jquery"),i=e("#mfz/0.1.0/mfz");i.ui=i.ui||{},e.async("css/emotion.css");var s=[{title:"微笑",src:"m_01.png"},{title:"偷笑",src:"m_02.png"},{title:"得意",src:"m_03.png"},{title:"害羞",src:"m_04.png"},{title:"呲笑",src:"m_05.png"},{title:"赞",src:"m_06.png"},{title:"yeah",src:"m_07.png"},{title:"发怒",src:"m_08.png"},{title:"咒骂",src:"m_09.png"},{title:"哼",src:"m_10.png"},{title:"差",src:"m_11.png"},{title:"尴尬",src:"m_12.png"},{title:"冷汗",src:"m_13.png"},{title:"囧",src:"m_14.png"},{title:"无语",src:"m_15.png"},{title:"衰",src:"m_16.png"},{title:"流泪",src:"m_17.png"},{title:"难过",src:"m_18.png"},{title:"可爱",src:"m_19.png"},{title:"色",src:"m_20.png"},{title:"调皮",src:"m_21.png"},{title:"亲亲",src:"m_22.png"},{title:"惊讶",src:"m_23.png"},{title:"惊恐",src:"m_24.png"},{title:"闭嘴",src:"m_25.png"},{title:"疑问",src:"m_26.png"},{title:"嘘",src:"m_27.png"},{title:"晕",src:"m_28.png"},{title:"白眼",src:"m_29.png"},{title:"睡",src:"m_30.png"},{title:"酷",src:"m_31.png"},{title:"发呆",src:"m_32.png"}],o="http://image.iwanmei.com/smiley/";return i.ui.Emotion=i.View.createClass(new Function,{isinit:!1,uiType:"emotion",imageFolder:o,dftImg:"http://image.iwanmei.com/smiley/0.gif",isShow:!1,smiley:s,init:function(){var e=this;e.textarea.length&&(e.textarea=e.textarea[0]),e.bindEvents()},tplPanelString:'<div class="#{clsWrap}"><div class="#{arrowOuter}"></div><div class="#{arrowInner}"></div><div class="#{clscnt}">#{content}</div><div class="#{clsPreview}"></div></div>',showEmotion:function(){var e=this;if(e.isinit)e.panel.show();else{e.isinit=!0;var t=[],n=11,s=e.smiley.length/n,o=24;t.push('<table cellpadding="1" cellspacing="0" align="center" width="100%">');for(var u=0;u<s;u++){t.push("<tr>");for(var a=0;a<n;a++){var f=e.smiley[u*n+a],l=(u*n+a)*-1*o;f?(t.push('<td title="'+f.title+'" onclick="'+e.getCallString("render",e.imageFolder+f.src,f.title)+'" onmouseover="'+e.getCallString("_over",u*n+a)+'" onmouseout="'+e.getCallRef()+'._out(this)" style="cursor:pointer;">'),t.push('<span style="display:block;"><img style="background-position:left '+l+'px;" alt="'+f.title+'" src="'+e.dftImg+'" height="24" width="24"/></span>'),t.push("</td>")):t.push("<td></td>")}t.push("</tr>")}t.push("</table>"),e.panel=r(i.format(e.tplPanelString,{clsWrap:e.getClass("wrap"),arrowOuter:e.getClass("arrow-o"),arrowInner:e.getClass("arrow-i"),clscnt:e.getClass("cnt"),clsPreview:e.getClass("preview"),content:t.join("")})),r("body").append(e.panel),e.panel.bind("click.emotion",function(e){e.stopPropagation()}),e.preview=i.q(e.getClass("preview"),e.panel)}var l=e.el.offset();e.panel.css({left:l.left+(e.el.outerWidth()/2-16),top:l.top+e.el.outerHeight()-6}),e.isShow=!0},hideEmotion:function(){this.panel.hide(),this.isShow=!1},bindEvents:function(){var e=this;e.el.click(function(t){t.stopPropagation(),e.isShow?e.hideEmotion():e.showEmotion()}),r("html").bind("click.emotion",function(){e.panel&&e.hideEmotion()})},_over:function(e,t,n){var s=this,o=r(t);o.addClass(s.getClass("hover"));var u=s.smiley[e],a='<div class="#{clsPreviewImg}"><img src="#{src}"/></div><div class="#{clsPreviewName}">#{title}</div>';s.preview.html(i.format(a,{title:u.title,src:s.imageFolder+u.src,clsPreviewName:s.getClass("preview-name"),clsPreviewImg:s.getClass("preview-img")})),e%11>5?s.preview.css({left:3,right:"auto"}):s.preview.css({left:"auto",right:3}),s.preview.show()},_out:function(e,t){var n=this,i=r(e);i.removeClass(n.getClass("hover")),n.preview.hide()},insertText:function(e){var t=this;t.textarea.focus();if(t.textarea.document&&t.textarea.document.selection)t.textarea.document.selection.createRange().text=e;else if("selectionStart"in t.textarea){var n=t.textarea.value,r=t.textarea.selectionStart;t.textarea.value=n.substr(0,r)+e+n.substring(t.textarea.selectionEnd,n.length),t.textarea.selectionStart=r+e.length,t.textarea.selectionEnd=r+e.length}},convert:function(e){var t=this;for(var n=0;n<t.smiley.length;n++){var r=t.smiley[n];e=e.replace(new RegExp("\\["+r.title+"\\]","g")," <img src='"+t.imageFolder+r.src+"'/> ")}return e},render:function(e,t){var n=this;n.insertText("["+t+"]"),n.hideEmotion(),n.fire("onrender")}}),i.ui.Emotion.convert=function(e){var t={};for(var n=0;n<s.length;n++){var r=s[n];t[r.title]=r.src}return e=String(e).replace(/\[([^\[\]]+)\]/g,function(e,n,r,i){return typeof t[n]!="undefined"?" <img src='"+o+t[n]+"' title='"+n+"' style='vertical-align:bottom;'/> ":e}),e},i});